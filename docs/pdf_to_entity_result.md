# PDF 處理結果分析

## 處理結果總結

根據終端輸出（行 856-1003），PDF 處理已完成：

### 處理統計

- **PDF 文件**: `1051219長期照護2.0核定本.pdf`
- **文字長度**: 128,197 字元
- **分塊數量**: 65 個區塊（每個約 2000 字元）
- **文件 ID**: `doc_1051219長期照護2.0核定本_95057e44`
- **實體總數**: 65 個
- **關係總數**: 0 個

### 實體分析

**實體類型分布**（預期）：
- **Document**: 1 個（主文件）
- **Concept**: 64 個（從規則基礎提取）

**為什麼只有 65 個實體**：
1. 每個區塊提取了 1 個實體
2. 這些實體是通過降級方案（規則基礎提取）獲得的
3. LLM 服務是 Stub，無法返回 JSON 格式的實體列表

### 關係分析

**為什麼沒有關係**：
1. 關係提取依賴於實體提取
2. LLM 服務是 Stub，無法返回 JSON 格式的關係
3. 系統會優雅降級，不會中斷處理

## 如何查看詳細數據

### 方法 1: 使用查詢腳本

```powershell
python scripts\view_entities.py
```

**輸出內容**：
- 實體總數和關係總數
- 實體類型統計
- 文件實體詳細資訊
- 文件包含的實體列表
- 其他實體範例

### 方法 2: 使用資料庫檢查腳本

```powershell
python scripts\check_db.py
```

**輸出內容**：
- 資料庫檔案資訊
- 資料表記錄數
- 實體類型統計
- 關係類型統計

### 方法 3: 直接查詢 SQLite

```powershell
# 使用 sqlite3 命令列工具
sqlite3 data\graph.db "SELECT type, COUNT(*) FROM entities GROUP BY type;"
```

## 預期結果

### 實體數據

**文件實體**：
- ID: `doc_1051219長期照護2.0核定本_95057e44`
- 名稱: `1051219長期照護2.0核定本.pdf`
- 屬性:
  - `source`: PDF 文件路徑
  - `chunks`: 65
  - `total_length`: 128197

**其他實體**：
- 類型: `Concept`
- 來源: 規則基礎提取（正則表達式）
- 屬性: `{"extracted_by": "rule_based"}`

### 關係數據

**CONTAINS 關係**：
- 來源: 文件實體 ID
- 目標: 各個區塊實體 ID
- 類型: `CONTAINS`
- 預期數量: 64 個（65 個區塊 - 1 個主文件）

## 改善建議

### 1. 實作真正的 LLM 整合

實作真正的 LLM API 整合，可以：
- 提取更多實體（不只是 1 個/區塊）
- 提取實體間的關係
- 提高提取準確度

### 2. 改進規則基礎提取

在 `_rule_based_entity_extraction()` 中添加更多規則：
- 提取日期格式
- 提取數字和統計數據
- 提取專有名詞（人名、地名、組織名）

### 3. 調整分塊策略

- 使用語義分塊（而不是固定長度）
- 確保每個區塊包含完整句子
- 避免在實體中間分塊

## 相關文檔

- `docs/qa/database_query_qa.md` - 資料庫查詢問答
- `docs/qa/stub_qa.md` - Stub 相關問答
- `docs/qa/json_parse_error_qa.md` - JSON 解析錯誤問答

